# Main entrypoint of the workflow. 
# Please follow the best practices: 
# https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html,
# in particular regarding the standardized folder structure mentioned there. 
import os

PWD = os.getcwd()
INPUT_PATH = "/mnt/shared/nationwide/cell_type_datasets"

rule all:
	input:
		f"{PWD}/results/scanpy_integration.h5ad",
		f"{PWD}/results/seurat_integration.h5Seurat"

rule scanpy:
	input:
		f"{INPUT_PATH}/human_brca_immune.h5ad"
	output:
		f"{PWD}/results/scanpy_integration.h5ad",
		f"{PWD}/results/scanpy_report.png"
	shell:
		"python scripts/python_scripts/scelect_scanpy.py /mnt/shared/nationwide/cell_type_datasets /home/user/Workspace/scelect/workflow/results development_stage"

rule seurat:
	input:
		f"{INPUT_PATH}/immune.rds"
	output:
		f"{PWD}/results/seurat_integration.h5Seurat",
		f"{PWD}/results/seurat_report.png",
		f"{PWD}/results/cca_umap_plot.png",
		f"{PWD}/results/rpca_umap_plot.png"
	container:
		"seurat/container:latest"
	shell:
		"docker run "
		"--user $(id -u):$(id -g) "
		f"-v {INPUT_PATH}/immune.rds:/data/immune.rds "
		f"-v {PWD}/scripts:/scripts "
		f"-v {PWD}/results:/results seurat/container:latest "
		"/scripts/r_scripts/scelect_seurat.R "
		f"/data/immune.rds " 
		f"/results "
		"development_stage"